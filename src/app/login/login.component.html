<div class="main-div bg">
  <mat-card class="container login-container text-center m-5" >
    <div *ngIf="!displayUpdatePwd && isLogin">
      <h5 class=" mb-5 text-center text-capitalize title"><span>{{WORDING.login.title}}</span></h5>
      <div class="alert alert-danger w-100" *ngIf="displayLoginErrorMsg" role="alert">
        {{WORDING.login.error1}} <br>
        <span *ngIf="restTentativeCount > -1" >
        <span>  {{WORDING.login.attempts_worning}}</span> <br>
        <span><strong>{{restTentativeCount}}</strong> {{WORDING.login.attempts_remaining}}</span>
          </span>
      </div>
      <div class="alert alert-danger w-100" *ngIf="isUserDesabledErrorMsg" role="alert">
        {{WORDING.login.error2}}
      </div>
      <div class="alert alert-danger w-100" *ngIf="istechnicalErrorMsg" role="alert">
        {{WORDING.problem}}
      </div>
      <div class="w-75 mx-auto">
        <mat-form-field floatLabel="never" class=" mb-5 w-100">
          <input type="text" matInput placeholder="{{WORDING.login.userName}}" [(ngModel)]="user.username" required>
          <mat-error class="text-danger" *ngIf="nameFormControl.hasError('required')">
            {{WORDING.login.mondatory}}
          </mat-error>
        </mat-form-field>

        <mat-form-field floatLabel="never" class="container w-100 input_password-format">
          <div class="d-flex justify-content-start">
            <input [type]="fieldTextType ? 'text' : 'password'" matInput placeholder="{{WORDING.login.pwd}}"
                   [(ngModel)]="user.password" required name="password">
            <div class="float-right">
          <span class="">
            <i class="fa" [ngClass]="{'fa-eye-slash': !fieldTextType, 'fa-eye': fieldTextType}"
               (click)="toggleFieldTextType()"></i>
          </span>
            </div>
          </div>
          <mat-error class="text-danger" *ngIf="nameFormControl.hasError('required')">
            {{WORDING.login.mondatory}}
          </mat-error>
        </mat-form-field>
        <mat-checkbox [(ngModel)]="rememberMe" class="mb-5 float-left">{{WORDING.login.remember_me}}</mat-checkbox>

        <div class=" mb-5 w-100">
          <button class="w-100" mat-button color="primary" type="submit" title="{{WORDING.login.confirm}}"
                  (click)="login()">{{WORDING.login.confirm}}</button>
        </div>
        <div>
          <span class="w-100" >{{WORDING.login.signUp_msg}} <a class="primary-color" routerLink="/create">{{WORDING.login.signUp}}</a></span>
        </div>
        <div class="w-100"><a (click)="pwdForgotten()">{{WORDING.login.forgot_pwd}}</a></div>
      </div>
      <div>
      </div>
    </div>

    <div *ngIf="!displayUpdatePwd && !isLogin">
        <h3 class=" mb-5 text-center "><span>Entrez votre adresse mail pour réinitialiser votre mot de passe et laissez-vous guider.</span></h3>
        <div class="alert alert-danger w-100" *ngIf="isUserDesabledErrorMsg" role="alert">
          {{WORDING.login.error2}}
        </div>
        <div class="alert alert-danger w-100" *ngIf="isUserNotFound" role="alert">
          l'adresse e-mail n'est pas reconnue.
        </div>
        <div class="alert alert-danger w-100" *ngIf="istechnicalErrorMsg" role="alert">
          {{WORDING.problem}}
        </div>
      <div class="alert alert-success w-100" *ngIf="isEmailSend" role="alert">
        Un e-mail vous a été envoyer pour modifier votre mot de passe.
      </div>
        <div class="w-75 mx-auto">
          <mat-form-field floatLabel="never" class=" mb-5 w-100">
            <input type="email" [email]="true" matInput placeholder="{{WORDING.individu.attributs.email}}"
                   [(ngModel)]="userEmail" required>
            <mat-error class="text-danger" *ngIf="nameFormControl.hasError('required')">
              {{WORDING.login.mondatory}}
            </mat-error>
          </mat-form-field>

          <div class=" mb-3 w-100">
            <button class="btn btn-success w-100" [disabled]="isNotValidEmail()" (click)="checkUserByEmail()"
                    title="{{WORDING.login.confirm}}">{{WORDING.login.confirm}}</button>
          </div>
          <div class="mt-1"><a routerLink="/"  (click)="switchToLogin()" title="{{WORDING.individu_create.return_btn}}"
                               class="text-center text-capitalize text-dark">{{WORDING.individu_create.return_btn}}</a>
          </div>
        </div>
    </div>

    <div *ngIf="displayUpdatePwd">
      <h4 class=" mb-5 text-center "><span>Initialié votre mot de passe</span></h4>
      <div class="alert alert-danger w-100" *ngIf="istechnicalErrorMsg" role="alert">
        {{WORDING.problem}}
      </div>
      <div class="alert alert-danger w-100" *ngIf="isNotValidOrExpiredKeyMsg" role="alert">
        La session a expirée, veillez reéssayé
      </div>
      <div class="alert alert-success w-100" *ngIf="isPwpUpdatedSuccessfullyMsg" role="alert">
        Votre mot de passe a été initialié avec succes
      </div>

      <!-- Password validation -->
      <mat-form-field floatLabel="never" class="row mb-5 w-100">
        <input type="password" matInput placeholder="{{WORDING.individu.attributs.pwd}}" [(ngModel)]="pwd"
               required minlength="8"
               pattern="^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$"
               name="pwd">
        <mat-error class="text-danger" *ngIf="nameFormControl.hasError('required')">
          <span [innerHTML]="WORDING.individu_create.pw_regex"></span>
        </mat-error>
      </mat-form-field>

      <mat-form-field floatLabel="never" class="row mb-1 w-100">
        <input type="password" matInput placeholder="{{WORDING.individu.attributs.confirm_pwd}}"
               [(ngModel)]="pwdConfirmation" required
               minlength="8" pattern="^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$"
               name="pwdConfirm">
        <mat-error class="text-danger" *ngIf="nameFormControl.hasError('required')">
          <span [innerHTML]="WORDING.individu_create.pw_regex"></span>
        </mat-error>
      </mat-form-field>
      <div *ngIf="!isConformPwd()" class=" text-danger mb-5" role="alert">
        <span [innerHTML]="WORDING.individu_create.pw_identique"></span>
      </div>

        <div class="mt-4 mb-2 w-100">
          <button class="w-100" mat-button color="primary" (click)="updtePwdWithKey()" [disabled]="!isConformPwd()" type="submit" title="{{WORDING.login.confirm}}" >{{WORDING.login.confirm}}</button>
        </div>
      <div class="mt-1"><a routerLink="/"  (click)="switchToLogin()" title="{{WORDING.individu_create.return_btn}}"
                           class="text-center text-capitalize text-dark">{{WORDING.individu_create.return_btn}}</a>
      </div>
      </div>
  </mat-card>
</div>
